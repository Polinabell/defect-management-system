# Пользовательские истории (User Stories)
## Система управления дефектами на строительных объектах

---

## Epic 1: Управление пользователями и безопасность

### US-001: Регистрация пользователя
**Как** администратор системы  
**Я хочу** создавать аккаунты для новых пользователей  
**Чтобы** обеспечить контролируемый доступ к системе  

**Критерии приёмки:**
- Администратор может создать нового пользователя с указанием ФИО, email, роли
- Система генерирует временный пароль для первого входа
- Email пользователя должен быть уникальным в системе
- Пользователь получает уведомление с данными для входа

**DoD (Definition of Done):**
- Реализована форма создания пользователя
- Добавлена валидация входных данных
- Написаны unit-тесты
- Документирован API endpoint

---

### US-002: Вход в систему
**Как** зарегистрированный пользователь  
**Я хочу** войти в систему используя свои учётные данные  
**Чтобы** получить доступ к функциям согласно моей роли  

**Критерии приёмки:**
- Пользователь может войти используя email/логин и пароль
- Система выдаёт JWT токен при успешной аутентификации
- Неверные данные приводят к понятному сообщению об ошибке
- После 5 неудачных попыток аккаунт блокируется на 15 минут

**DoD:**
- Реализована форма входа
- Настроена JWT аутентификация
- Добавлена защита от брute-force атак
- Написаны интеграционные тесты

---

### US-003: Смена пароля
**Как** пользователь системы  
**Я хочу** сменить свой пароль  
**Чтобы** обеспечить безопасность моего аккаунта  

**Критерии приёмки:**
- Пользователь может сменить пароль в личном кабинете
- Требуется ввод текущего пароля для подтверждения
- Новый пароль должен соответствовать политике безопасности
- При первом входе пользователь обязан сменить временный пароль

---

## Epic 2: Управление проектами

### US-004: Создание проекта
**Как** менеджер проекта  
**Я хочу** создать новый строительный проект  
**Чтобы** организовать работу по контролю качества объекта  

**Критерии приёмки:**
- Менеджер может создать проект с указанием названия, адреса, заказчика
- Можно установить плановые даты начала и завершения
- Можно назначить участников проекта из списка пользователей
- Название проекта должно быть уникальным

**DoD:**
- Реализована форма создания проекта
- Настроена связь проекта с пользователями
- Добавлена валидация дат
- Написаны unit-тесты для модели Project

---

### US-005: Управление этапами проекта
**Как** менеджер проекта  
**Я хочу** разбить проект на этапы строительства  
**Чтобы** структурировать контроль дефектов по видам работ  

**Критерии приёмки:**
- Можно создавать этапы с названием и описанием
- Этапы имеют плановые даты начала и завершения
- Можно назначить ответственного за этап
- Есть предустановленные шаблоны этапов

**DoD:**
- Реализована модель ProjectStage
- Создана форма управления этапами
- Добавлены шаблоны этапов по умолчанию
- Написаны тесты

---

## Epic 3: Управление дефектами

### US-006: Регистрация дефекта
**Как** инженер  
**Я хочу** зарегистрировать выявленный дефект  
**Чтобы** зафиксировать нарушение для последующего устранения  

**Критерии приёмки:**
- Можно создать дефект с заголовком, описанием, категорией
- Можно указать местоположение и приоритет
- Можно прикрепить до 5 фотографий и 3 документов
- Автоматически устанавливается статус "Новый" и автор

**DoD:**
- Реализована модель Defect с необходимыми полями
- Создана форма регистрации дефекта
- Настроена загрузка файлов
- Добавлена валидация типов и размеров файлов
- Написаны unit-тесты

---

### US-007: Назначение исполнителя
**Как** менеджер проекта  
**Я хочу** назначить исполнителя для устранения дефекта  
**Чтобы** определить ответственного и сроки выполнения  

**Критерии приёмки:**
- Можно выбрать исполнителя из участников проекта
- Можно установить плановую дату устранения
- Можно добавить комментарий к назначению
- Статус дефекта автоматически меняется на "В работе"

**DoD:**
- Реализована функция назначения исполнителя
- Добавлена валидация прав доступа
- Настроено автоматическое изменение статуса
- Написаны интеграционные тесты

---

### US-008: Обновление статуса дефекта
**Как** исполнитель  
**Я хочу** обновить статус дефекта после выполнения работ  
**Чтобы** сообщить о готовности к проверке  

**Критерии приёмки:**
- Исполнитель может изменить статус с "В работе" на "На проверке"
- Можно добавить комментарий о выполненных работах
- Можно прикрепить фотографии результата
- Система фиксирует дату изменения статуса

**DoD:**
- Реализован механизм смены статусов
- Добавлена валидация переходов между статусами
- Настроено логирование изменений
- Написаны тесты для workflow

---

### US-009: Проверка выполнения дефекта
**Как** менеджер проекта  
**Я хочу** проверить качество устранения дефекта  
**Чтобы** подтвердить выполнение или вернуть на доработку  

**Критерии приёмки:**
- Можно изменить статус с "На проверке" на "Закрыт" или "В работе"
- Можно добавить комментарий о результате проверки
- При возврате на доработку можно указать причины
- Система уведомляет исполнителя о результате проверки

---

### US-010: Добавление комментариев
**Как** участник проекта  
**Я хочу** добавлять комментарии к дефекту  
**Чтобы** обсуждать детали и уточнения  

**Критерии приёмки:**
- Любой участник проекта может добавить комментарий
- Комментарии отображаются в хронологическом порядке
- Можно прикреплять файлы к комментариям
- Есть уведомления о новых комментариях

**DoD:**
- Реализована модель Comment
- Создан интерфейс для добавления комментариев
- Настроены уведомления
- Написаны тесты

---

## Epic 4: Поиск и фильтрация

### US-011: Поиск дефектов
**Как** пользователь системы  
**Я хочу** быстро найти нужные дефекты  
**Чтобы** эффективно работать с большим количеством записей  

**Критерии приёмки:**
- Можно искать по тексту в заголовке и описании
- Можно фильтровать по проекту, статусу, приоритету
- Можно фильтровать по исполнителю и датам
- Можно сохранять часто используемые фильтры

**DoD:**
- Реализован полнотекстовый поиск
- Созданы фильтры по всем основным полям
- Добавлена возможность сохранения фильтров
- Написаны тесты поиска

---

### US-012: Сортировка результатов
**Как** пользователь системы  
**Я хочу** сортировать список дефектов  
**Чтобы** просматривать их в удобном порядке  

**Критерии приёмки:**
- Можно сортировать по дате создания, приоритету, статусу
- Можно сортировать по исполнителю и сроку выполнения
- Поддерживается сортировка по возрастанию и убыванию
- Настройка сортировки сохраняется в сессии

---

## Epic 5: Отчётность и аналитика

### US-013: Просмотр дашборда
**Как** менеджер проекта  
**Я хочу** видеть общую статистику по проекту  
**Чтобы** контролировать прогресс и выявлять проблемы  

**Критерии приёмки:**
- Отображается общее количество дефектов по статусам
- Показывается динамика создания/закрытия дефектов
- Есть топ исполнителей по эффективности
- Отображается распределение по приоритетам

**DoD:**
- Реализованы виджеты дашборда
- Добавлены графики с использованием Chart.js
- Настроена автоматическая загрузка данных
- Написаны тесты для API аналитики

---

### US-014: Экспорт отчётов
**Как** менеджер проекта  
**Я хочу** экспортировать данные о дефектах  
**Чтобы** готовить отчёты для руководства и заказчика  

**Критерии приёмки:**
- Можно экспортировать в форматах CSV, Excel, PDF
- Экспорт учитывает текущие фильтры
- Можно выбрать поля для включения в отчёт
- Файлы генерируются с корректными именами и структурой

**DoD:**
- Реализованы генераторы отчётов
- Добавлена возможность выбора полей
- Настроена генерация имён файлов
- Написаны тесты экспорта

---

### US-015: Аналитические отчёты
**Как** руководитель  
**Я хочу** получать детальную аналитику по всем проектам  
**Чтобы** принимать управленческие решения  

**Критерии приёмки:**
- Сводный отчёт по всем проектам организации
- Анализ производительности исполнителей
- Статистика по соблюдению сроков
- Анализ типовых дефектов и их причин

---

## Epic 6: Администрирование

### US-016: Управление пользователями
**Как** администратор  
**Я хочу** управлять учётными записями пользователей  
**Чтобы** контролировать доступ к системе  

**Критерии приёмки:**
- Можно создавать, редактировать и деактивировать пользователей
- Можно изменять роли и права доступа
- Можно сбрасывать пароли пользователей
- Есть журнал действий пользователей

---

### US-017: Настройка системы
**Как** администратор  
**Я хочу** настраивать параметры системы  
**Чтобы** адаптировать её под требования организации  

**Критерии приёмки:**
- Можно настраивать категории дефектов
- Можно настраивать уровни приоритетов
- Можно настраивать шаблоны этапов проектов
- Можно настраивать параметры уведомлений

---

## Пользовательские роли и права доступа

### Администратор
- Полный доступ ко всем функциям системы
- Управление пользователями и их ролями
- Настройка системных параметров
- Доступ к журналам и аудиту

### Менеджер проекта
- Создание и управление проектами
- Назначение участников проекта
- Назначение исполнителей дефектов
- Контроль сроков и качества
- Генерация отчётов по проектам

### Инженер
- Регистрация дефектов
- Обновление статуса назначенных дефектов
- Добавление комментариев
- Просмотр отчётов по своей работе

### Наблюдатель
- Просмотр всех данных (только чтение)
- Генерация и экспорт отчётов
- Просмотр аналитики

---

## Критерии приёмки Epic'ов

### Epic 1: Управление пользователями (Завершён)
- ✅ Все пользователи могут безопасно войти в систему
- ✅ Права доступа работают согласно ролям
- ✅ Пароли хранятся в защищённом виде
- ✅ Есть защита от попыток взлома

### Epic 2: Управление проектами (Завершён)
- ✅ Менеджеры могут создавать и управлять проектами
- ✅ Проекты структурированы по этапам
- ✅ Участники проекта назначены корректно

### Epic 3: Управление дефектами (Завершён)
- ✅ Полный жизненный цикл дефекта работает
- ✅ Файлы прикрепляются и отображаются корректно
- ✅ История изменений ведётся полностью

### Epic 4: Поиск и фильтрация (Завершён)
- ✅ Поиск находит релевантные результаты
- ✅ Фильтры работают в комбинации
- ✅ Производительность поиска приемлема

### Epic 5: Отчётность (Завершён)
- ✅ Дашборд отображает актуальную информацию
- ✅ Экспорт генерирует корректные файлы
- ✅ Графики загружаются быстро

### Epic 6: Администрирование (Завершён)
- ✅ Все административные функции работают
- ✅ Настройки применяются корректно
- ✅ Аудит фиксирует все действия
